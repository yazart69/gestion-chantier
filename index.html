<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Chantier Pro</title>
    <script src="database.js"></script>
    <style>
        :root {
            --primary-blue: #0066cc; --primary-orange: #ff6600; --success-color: #198754; --danger-color: #dc3545;
            --light-bg: #f8f9fa; --white: #ffffff; --border-color: #dee2e6; --text-color: #212529; 
            --shadow-sm: 0 .125rem .25rem rgba(0,0,0,.075);
        }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--light-bg); display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 250px; background-color: #002b49; color: white; padding: 1.5rem 0; display: flex; flex-direction: column; flex-shrink: 0; }
        #sidebar h1 { font-size: 1.5rem; text-align: center; margin: 0 1rem 2rem 1rem; color: white; }
        #sidebar nav ul { list-style: none; padding: 0; margin: 0; }
        #sidebar nav a { display: block; padding: 1rem 1.5rem; color: #d1d5db; text-decoration: none; font-weight: 500; transition: background-color 0.2s, color 0.2s; border-left: 4px solid transparent; cursor: pointer; }
        #sidebar nav a:hover { background-color: rgba(255, 255, 255, 0.1); color: white; }
        #sidebar nav a.active { background-color: var(--primary-blue); color: white; border-left-color: var(--primary-orange); }
        #main-content { flex-grow: 1; overflow-y: auto; padding: 2rem; }
        #module-container { max-width: 1400px; margin: 0 auto; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* ... (tous les styles des modules peuvent √™tre ajout√©s ici si n√©cessaire) ... */
        .card { background: white; border-radius: 1rem; box-shadow: var(--shadow-sm); padding: 1.5rem; margin-bottom: 2rem; border: 1px solid var(--border-color); }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 1rem; color: #6c757d; }
        .form-select, .form-input, .form-textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; }
        .btn { border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; }
    </style>
</head>
<body>
    <aside id="sidebar">
        <h1>Gestion Chantiers</h1>
        <nav>
             <ul>
                <li><a class="nav-link active" data-module="tableau_de_bord">üìä Tableau de Bord</a></li>
                <li><a class="nav-link" data-module="planning">üìÖ Planning</a></li>
                <li><a class="nav-link" data-module="reunion">üìù R√©unions</a></li>
                <li><a class="nav-link" data-module="travaux_materiaux">üõ†Ô∏è Travaux & Mat√©riaux</a></li>
                <li><a class="nav-link" data-module="equipe">üë• √âquipe</a></li>
                <li><a class="nav-link" data-module="chantier">üöß Infos Chantier</a></li>
            </ul>
        </nav>
    </aside>

    <main id="main-content">
        <div id="module-container"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const moduleContainer = document.getElementById('module-container');
            const navLinks = document.querySelectorAll('.nav-link');

            // =================================================================
            // TEMPLATES HTML DE CHAQUE MODULE (Contenu des anciens fichiers)
            // =================================================================
            const moduleTemplates = {
                'tableau_de_bord': `
                    <div class="container">
                        <h1>Tableau de Bord de Gestion</h1>
                        <div class="card" id="inputs-card">
                            <h2>Donn√©es d'Entr√©e</h2>
                            <div class="input-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                                <div><label for="chantier-select-tdb">Chantier</label><select id="chantier-select-tdb" class="form-select"></select></div>
                                <div><label for="cout-operateur">Co√ªt/Op√©rateur (‚Ç¨/h)</label><input type="number" id="cout-operateur" class="form-input" value="14"></div>
                                <div><label for="heures-realisees">Heures MO R√©alis√©es</label><input type="number" id="heures-realisees" class="form-input" value="0"></div>
                                <div><label for="depense-st">D√©penses Sous-Traitance (‚Ç¨)</label><input type="number" id="depense-st" class="form-input" value="0"></div>
                                <div><label for="depense-fournitures">D√©penses Fournitures (‚Ç¨)</label><input type="number" id="depense-fournitures" class="form-input" value="0"></div>
                                <div><label for="depense-locations">D√©penses Locations (‚Ç¨)</label><input type="number" id="depense-locations" class="form-input" value="0"></div>
                                <div><label for="imprevus-pct">Impr√©vus (%)</label><input type="number" id="imprevus-pct" class="form-input" value="7"></div>
                            </div>
                        </div>
                        </div>`,
                'planning': `<div class="container"><h1>Planning (en construction)</h1></div>`,
                'reunion': `<div class="container"><h1>R√©unions (en construction)</h1></div>`,
                'travaux_materiaux': `<div class="container"><h1>Travaux & Mat√©riaux (en construction)</h1></div>`,
                'equipe': `<div class="container"><h1>√âquipe (en construction)</h1></div>`,
                'chantier': `<div class="container"><h1>Info Chantier (en construction)</h1></div>`
            };
            
            // =======================================================
            // LOGIQUE JAVASCRIPT DE L'APPLICATION
            // =======================================================
            const moduleInitializers = {
                'tableau_de_bord': () => {
                    const chantierSelect = document.getElementById('chantier-select-tdb');
                    if (!chantierSelect) return;
                    
                    const chantiers = DB.getChantiers();
                    chantiers.forEach(c => {
                        chantierSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`;
                    });

                    function formatCurrency(value) { return `${Math.round(value).toLocaleString('fr-FR')} ‚Ç¨`; }
                    
                    function updateDashboard() {
                        const chantierId = chantierSelect.value;
                        if (!chantierId) return;
                        
                        const chantier = DB.getChantierById(chantierId);
                        const tasks = DB.getPlanningForChantier(chantierId);
                        
                        // Recalcul des heures r√©alis√©es depuis les t√¢ches du planning
                        const heuresRealiseesFromPlanning = tasks.reduce((sum, task) => sum + (task.heuresHomme * (task.progression / 100)), 0);
                        document.getElementById('heures-realisees').value = heuresRealiseesFromPlanning.toFixed(1);

                        const coutParOperateur = parseFloat(document.getElementById('cout-operateur').value) || 0;
                        const imprevusPct = parseFloat(document.getElementById('imprevus-pct').value) || 0;
                        const depenseST = parseFloat(document.getElementById('depense-st').value) || 0;
                        const depenseFournitures = parseFloat(document.getElementById('depense-fournitures').value) || 0;
                        const depenseLocations = parseFloat(document.getElementById('depense-locations').value) || 0;

                        const coutMOActuel = heuresRealiseesFromPlanning * coutParOperateur;
                        // ... (toute la logique de calcul du tableau de bord) ...
                        
                        console.log("Dashboard mis √† jour pour le chantier: " + chantier.name);
                    }
                    
                    document.getElementById('inputs-card').addEventListener('input', updateDashboard);
                    if (chantiers.length > 0) updateDashboard();
                }
                // Les autres initialiseurs seront ajout√©s ici
            };

            // --- MOTEUR DE NAVIGATION ---
            function navigate(moduleName) {
                // Mettre √† jour la classe active dans la sidebar
                navLinks.forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-link[data-module="${moduleName}"]`);
                if (activeLink) activeLink.classList.add('active');

                // Charger le HTML et ex√©cuter le script
                if (moduleTemplates[moduleName]) {
                    moduleContainer.innerHTML = moduleTemplates[moduleName];
                    if (moduleInitializers[moduleName]) {
                        moduleInitializers[moduleName]();
                    }
                } else {
                    moduleContainer.innerHTML = 'Module non trouv√©.';
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const moduleName = e.currentTarget.dataset.module;
                    navigate(moduleName);
                });
            });

            // Charger le module par d√©faut
            navigate('tableau_de_bord');
        });
    </script>
</body>
</html>
