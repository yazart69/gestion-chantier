<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Booster - Équipe 41</title>
    <style>
        :root {
            --sidebar-width: 280px;
            --primary-red: #dc2626;
            --primary-orange: #ea580c;
            --primary-blue: #2563eb;
            --success: #16a34a;
            --warning: #d97706;
            --danger: #dc2626;
            --info: #0ea5e9;
            --purple: #7c3aed;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-700: #374151;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, #e0e7ff 100%);
            color: var(--gray-900);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, var(--primary-red), var(--primary-orange));
            color: white;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 4px 0 20px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
        }

        .sidebar-header {
            padding: 2rem 1.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .sidebar-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .sidebar ul {
            list-style: none;
            padding: 1rem 0;
        }

        .sidebar li {
            margin: 0.3rem 0;
        }

        .sidebar a {
            display: block;
            padding: 1rem 1.5rem;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 0 25px 25px 0;
            margin-right: 1rem;
            font-weight: 500;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(8px);
        }

        /* Main Content */
        .content-with-sidebar {
            margin-left: 260px;
            min-height: 100vh;
            padding: 2rem;
        }

        /* Header with Glassmorphism */
        .page-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, var(--primary-red)15, var(--primary-orange)15);
            border-radius: 50%;
            transform: translate(40%, -40%);
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-red), var(--primary-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .page-subtitle {
            font-size: 1.2rem;
            color: var(--gray-700);
            font-weight: 500;
        }

        /* Enhanced Controls */
        .controls-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .control-group label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chantier-selector {
            position: relative;
        }

        .chantier-selector select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
            appearance: none;
            cursor: pointer;
        }

        .chantier-selector::after {
            content: '▼';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-red);
            font-size: 0.8rem;
            pointer-events: none;
        }

        .chantier-selector select:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .view-modes {
            display: flex;
            gap: 0.5rem;
            background: var(--gray-100);
            padding: 0.5rem;
            border-radius: 1rem;
        }

        .view-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--gray-700);
        }

        .view-btn.active {
            background: linear-gradient(135deg, var(--primary-red), var(--primary-orange));
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Enhanced Buttons */
        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 1rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), #1e40af);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #b45309);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
            color: white;
        }

        .btn-gradient {
            background: linear-gradient(135deg, var(--primary-red), var(--primary-orange));
            color: white;
        }

        /* Gantt Container */
        .gantt-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .gantt-header {
            display: grid;
            grid-template-columns: 300px 1fr;
            background: linear-gradient(135deg, var(--primary-red), var(--primary-orange));
            color: white;
            font-weight: 700;
            border-radius: 1rem 1rem 0 0;
            overflow: hidden;
        }

        .gantt-task-header {
            display: flex;
            align-items: center;
            padding: 1.5rem 2rem;
            font-size: 1.1rem;
            background: rgba(0,0,0,0.1);
        }

        .gantt-dates-header {
            display: flex;
            overflow-x: auto;
        }

        .gantt-date-cell {
            flex-shrink: 0;
            padding: 1rem;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
            border-left: 1px solid rgba(255,255,255,0.2);
            min-width: 60px;
        }

        .gantt-date-cell.weekend {
            background: rgba(0,0,0,0.1);
        }

        .gantt-body {
            max-height: 600px;
            overflow-y: auto;
        }

        .gantt-row {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 70px;
            border-bottom: 1px solid var(--gray-200);
            transition: background-color 0.2s ease;
        }

        .gantt-row:hover {
            background: var(--gray-50);
        }

        .gantt-task-cell {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 1rem 2rem;
            background: rgba(248, 250, 252, 0.8);
            border-right: 2px solid var(--gray-200);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gantt-task-cell:hover {
            background: rgba(220, 38, 38, 0.05);
            border-right-color: var(--primary-red);
        }

        .gantt-task-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .gantt-task-responsable {
            font-size: 0.85rem;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }

        .gantt-task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .gantt-chart-cell {
            position: relative;
            padding: 1rem 0;
            background: linear-gradient(to right, var(--gray-200) 1px, transparent 1px);
            background-size: 60px 100%;
        }

        .gantt-bar {
            position: absolute;
            height: 32px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            padding: 0 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .gantt-bar:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .gantt-bar-planifie {
            background: linear-gradient(135deg, var(--primary-blue), #1e40af);
        }

        .gantt-bar-en-cours {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .gantt-bar-en-retard {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
        }

        .gantt-bar-termine {
            background: linear-gradient(135deg, #14532d, #166534);
        }

        .gantt-bar-travaux-sup {
            background: linear-gradient(135deg, var(--purple), #6d28d9);
        }

        .gantt-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: rgba(255,255,255,0.3);
            border-radius: 16px;
            transition: width 0.8s ease;
        }

        /* Enhanced Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-orange));
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary-red);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
        }

        .progress-ring-circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring-bg {
            stroke: var(--gray-200);
        }

        .progress-ring-fill {
            stroke: url(#gradient);
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 1s ease;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 1rem;
            background: linear-gradient(135deg, var(--primary-red), var(--primary-orange));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.8rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gray-900);
        }

        /* Timeline */
        .timeline-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--primary-red), var(--primary-orange));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.5rem;
            top: 0.5rem;
            width: 12px;
            height: 12px;
            background: var(--primary-red);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--primary-red);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .timeline-title {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .timeline-desc {
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-500);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.9rem;
        }

        .form-input,
        .form-select {
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .range-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .range-input {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: var(--gray-200);
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-red);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .range-value {
            min-width: 40px;
            font-weight: 600;
            color: var(--primary-red);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-with-sidebar {
                margin-left: 0;
                padding: 1rem;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .gantt-header {
                grid-template-columns: 250px 1fr;
            }

            .gantt-row {
                grid-template-columns: 250px 1fr;
            }
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
        }

        /* Print Styles - A4 Paysage avec couleurs */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                size: A4 landscape;
                margin: 10mm;
            }

            body {
                background: white !important;
                font-size: 9pt;
                line-height: 1.2;
                color: black !important;
                margin: 0;
                padding: 0;
            }

            .sidebar,
            .modal {
                display: none !important;
            }

            .content-with-sidebar {
                margin-left: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                max-width: none !important;
            }

            /* Header compact pour impression */
            .page-header {
                background: linear-gradient(135deg, #dc2626, #ea580c) !important;
                color: white !important;
                border-radius: 8px !important;
                padding: 8mm !important;
                margin-bottom: 5mm !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
                position: relative;
            }

            .page-header::before {
                display: none !important;
            }

            .page-title {
                font-size: 18pt !important;
                font-weight: 900 !important;
                color: white !important;
                margin-bottom: 2mm !important;
                -webkit-text-fill-color: white !important;
            }

            .page-subtitle,
            #chantier-info {
                color: rgba(255, 255, 255, 0.9) !important;
                font-size: 10pt !important;
            }

            /* Masquer les contrôles */
            .controls-panel {
                display: none !important;
            }

            /* Stats en ligne horizontale */
            .stats-grid {
                display: grid !important;
                grid-template-columns: repeat(6, 1fr) !important;
                gap: 3mm !important;
                margin-bottom: 5mm !important;
                page-break-inside: avoid !important;
            }

            .stat-card {
                background: rgba(255, 255, 255, 0.98) !important;
                border: 1px solid #dc2626 !important;
                border-radius: 4mm !important;
                padding: 3mm !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
                text-align: center;
            }

            .stat-icon {
                width: 20px !important;
                height: 20px !important;
                background: linear-gradient(135deg, #dc2626, #ea580c) !important;
                color: white !important;
                border-radius: 3mm !important;
                font-size: 8pt !important;
                margin: 0 auto 2mm auto !important;
            }

            .stat-title {
                font-size: 6pt !important;
                color: #666 !important;
                margin-bottom: 1mm !important;
            }

            .stat-value {
                font-size: 9pt !important;
                font-weight: 800 !important;
                color: #dc2626 !important;
            }

            /* Dashboard sur 2 colonnes */
            .dashboard {
                display: grid !important;
                grid-template-columns: 40% 60% !important;
                gap: 5mm !important;
                margin-bottom: 5mm !important;
                page-break-inside: avoid !important;
            }

            .dashboard-card {
                background: rgba(255, 255, 255, 0.98) !important;
                border: 2px solid #dc2626 !important;
                border-radius: 4mm !important;
                padding: 4mm !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
            }

            .dashboard-card::before {
                background: linear-gradient(90deg, #dc2626, #ea580c) !important;
                height: 2px !important;
            }

            .card-title {
                font-size: 10pt !important;
                font-weight: 700 !important;
                color: #dc2626 !important;
                margin-bottom: 3mm !important;
            }

            .metric-value {
                font-size: 16pt !important;
                font-weight: 900 !important;
                color: #dc2626 !important;
                margin-bottom: 2mm !important;
            }

            .metric-label {
                font-size: 7pt !important;
                color: #666 !important;
            }

            /* Graphique circulaire */
            .progress-ring {
                width: 60px !important;
                height: 60px !important;
                margin: 0 auto 3mm auto !important;
            }

            .progress-ring-circle {
                stroke-width: 4 !important;
            }

            .progress-ring-bg {
                stroke: #e5e7eb !important;
            }

            .progress-ring-fill {
                stroke: url(#gradient) !important;
            }

            /* Gantt Chart optimisé */
            .gantt-container {
                background: white !important;
                border: 2px solid #dc2626 !important;
                border-radius: 4mm !important;
                padding: 3mm !important;
                margin-bottom: 5mm !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
                overflow: visible !important;
            }

            .gantt-header {
                background: linear-gradient(135deg, #dc2626, #ea580c) !important;
                color: white !important;
                border-radius: 2mm !important;
                grid-template-columns: 160px 1fr !important;
            }

            .gantt-task-header {
                padding: 3mm 4mm !important;
                font-size: 8pt !important;
                font-weight: 700 !important;
                color: white !important;
            }

            .gantt-dates-header {
                overflow: visible !important;
            }

            .gantt-date-cell {
                padding: 3mm 2mm !important;
                font-size: 6pt !important;
                font-weight: 600 !important;
                color: white !important;
                min-width: 30px !important;
                border-left: 1px solid rgba(255,255,255,0.3) !important;
            }

            .gantt-body {
                max-height: none !important;
                overflow: visible !important;
            }

            .gantt-row {
                grid-template-columns: 160px 1fr !important;
                min-height: 25px !important;
                border-bottom: 1px solid #e5e7eb !important;
                page-break-inside: avoid !important;
            }

            .gantt-task-cell {
                background: rgba(248, 250, 252, 0.9) !important;
                border-right: 1px solid #d1d5db !important;
                padding: 2mm 3mm !important;
            }

            .gantt-task-name {
                font-size: 7pt !important;
                font-weight: 700 !important;
                color: #111827 !important;
                margin-bottom: 1mm !important;
                line-height: 1.1;
            }

            .gantt-task-responsable {
                font-size: 6pt !important;
                color: #666 !important;
                margin-bottom: 1mm !important;
                line-height: 1.1;
            }

            .gantt-task-meta {
                font-size: 5pt !important;
                color: #999 !important;
                gap: 2mm !important;
            }

            .gantt-chart-cell {
                background: linear-gradient(to right, #e5e7eb 1px, transparent 1px) !important;
                background-size: 30px 100% !important;
                padding: 2mm 0 !important;
            }

            .gantt-bar {
                height: 16px !important;
                border-radius: 8px !important;
                font-size: 6pt !important;
                font-weight: 700 !important;
                color: white !important;
                padding: 0 3mm !important;
                box-shadow: none !important;
                border: 1px solid rgba(0,0,0,0.2) !important;
            }

            /* Couleurs des barres Gantt pour impression */
            .gantt-bar-planifie {
                background: linear-gradient(135deg, #2563eb, #1e40af) !important;
                color: white !important;
            }

            .gantt-bar-en-cours {
                background: linear-gradient(135deg, #16a34a, #059669) !important;
                color: white !important;
            }

            .gantt-bar-en-retard {
                background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
                color: white !important;
            }

            .gantt-bar-termine {
                background: linear-gradient(135deg, #14532d, #166534) !important;
                color: white !important;
            }

            .gantt-bar-travaux-sup {
                background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;
                color: white !important;
            }

            .gantt-progress {
                background: rgba(255,255,255,0.3) !important;
            }

            /* Timeline compacte */
            .timeline-card {
                background: rgba(255, 255, 255, 0.98) !important;
                border: 1px solid #dc2626 !important;
                border-radius: 4mm !important;
                padding: 4mm !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
            }

            .timeline::before {
                background: linear-gradient(180deg, #dc2626, #ea580c) !important;
                width: 1px !important;
                left: 8px !important;
            }

            .timeline-item {
                margin-bottom: 3mm !important;
                padding-left: 5mm !important;
                page-break-inside: avoid !important;
            }

            .timeline-item::before {
                width: 6px !important;
                height: 6px !important;
                left: -3px !important;
                top: 1mm !important;
                background: #dc2626 !important;
                border: 1px solid white !important;
                box-shadow: none !important;
            }

            .timeline-date {
                font-size: 6pt !important;
                color: #dc2626 !important;
                font-weight: 600 !important;
                margin-bottom: 1mm !important;
            }

            .timeline-title {
                font-size: 7pt !important;
                font-weight: 700 !important;
                color: #111827 !important;
                margin-bottom: 1mm !important;
                line-height: 1.1;
            }

            .timeline-desc {
                font-size: 6pt !important;
                color: #666 !important;
                line-height: 1.1;
            }

            /* Éviter les coupures */
            .page-header,
            .stats-grid,
            .dashboard,
            .gantt-container,
            .timeline-card,
            .gantt-row,
            .stat-card,
            .dashboard-card,
            .timeline-item {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            /* Marges et espacement pour A4 paysage */
            .content-with-sidebar > * {
                max-width: 100% !important;
            }

            /* Masquer les éléments non essentiels */
            .btn,
            .action-buttons,
            .view-modes {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar permanent -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                🏗️ Gestionnaire Chantier
            </div>
            <div class="sidebar-subtitle">
                Équipe 41 - Chasse sur Rhône
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Principal</div>
                <a href="index_v2.2.html" class="nav-item">
                    <span class="icon">🏠</span>
                    Tableau de Bord
                </a>
                <a href="planning_booster.html" class="nav-item active">
                    <span class="icon">📅</span>
                    Planning
                    <span class="badge">3</span>
                </a>
                <a href="pointage_booster.html" class="nav-item">
                    <span class="icon">⏰</span>
                    Pointage
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Gestion</div>
                <a href="module_equipe_modifie.html" class="nav-item">
                    <span class="icon">👥</span>
                    Équipe
                </a>
                <a href="module_travaux_materiaux_corrige.html" class="nav-item">
                    <span class="icon">🔧</span>
                    Travaux & Matériaux
                </a>
                <a href="module_reunion_moderne.html" class="nav-item">
                    <span class="icon">🗓️</span>
                    Réunions
                    <span class="badge">2</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Analyse</div>
                <a href="index_v2.2.html" class="nav-item" onclick="alert('Module en développement')">
                    <span class="icon">💰</span>
                    Finances
                </a>
                <a href="index_v2.2.html" class="nav-item" onclick="alert('Module en développement')">
                    <span class="icon">📊</span>
                    Rapports
                </a>
                <a href="index_v2.2.html" class="nav-item" onclick="alert('Module en développement')">
                    <span class="icon">⚙️</span>
                    Paramètres
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>📊 Planning Booster</h2>
            <p>Équipe 41 - Chasse sur Rhône</p>
        </div>
        <ul>
            <li><a href="index_v2.2.html">🏠 Accueil</a></li>
            <li><a href="index_v2.2.html">🏗️ Nouveau Chantier</a></li>
            <li><a href="planning_booster.html" class="active">📅 Planning</a></li>
            <li><a href="tableau_bord.html">💰 Analyse Financière</a></li>
            <li><a href="reunion.html">🗓️ Réunions</a></li>
            <li><a href="module_equipe_modifie.html">👥 Équipe</a></li>
            <li><a href="parametres.html">⚙️ Paramètres</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="content-with-sidebar">
        <!-- Header -->
        <div class="page-header">
            <div class="header-content">
                <div>
                    <h1 class="page-title">📅 Planning Booster</h1>
                    <p class="page-subtitle">Gestion avancée des projets • Équipe 41 Altrad Prezioso</p>
                </div>
                <div id="chantier-info" class="card-title">
                    <span class="card-icon">🏗️</span>
                    <span id="chantier-name">Grand Lyon – Pont de Chasse</span>
                </div>
            </div>
        </div>

        <!-- Enhanced Controls -->
        <div class="controls-panel">
            <div class="controls-grid">
                <div class="control-group">
                    <label>Chantier</label>
                    <div class="chantier-selector">
                        <select id="chantierSelect">
                            <option value="Grand Lyon – Pont de Chasse">Grand Lyon – Pont de Chasse</option>
                            <option value="VICHY">VICHY</option>
                            <option value="CAMPENON BERNARD">CAMPENON BERNARD</option>
                            <option value="EFFIA PARKING BARET">EFFIA PARKING BARET</option>
                            <option value="EFFIA PARKING CANNES">EFFIA PARKING CANNES</option>
                            <option value="Mirage 2000">Mirage 2000</option>
                            <option value="QPARK FAVENTINE">QPARK FAVENTINE</option>
                            <option value="BOUYGUE - VELODROME">BOUYGUE - VELODROME</option>
                            <option value="FRAMATOME">FRAMATOME</option>
                            <option value="Atelier St Maurice">Atelier St Maurice</option>
                            <option value="SAINT GOBAIN - Atelier">SAINT GOBAIN - Atelier</option>
                            <option value="EFFIA – MONTPELLIER">EFFIA – MONTPELLIER</option>
                            <option value="CNR VAUGRIS">CNR VAUGRIS</option>
                            <option value="QPARK HDV Marseille">QPARK HDV Marseille</option>
                            <option value="EFFIA BEZIERS">EFFIA BEZIERS</option>
                            <option value="ADISEO PONTICELLI">ADISEO PONTICELLI</option>
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <label>Vue</label>
                    <div class="view-modes">
                        <button class="view-btn" id="viewDay">Jour</button>
                        <button class="view-btn active" id="viewWeek">Semaine</button>
                        <button class="view-btn" id="viewMonth">Mois</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>Actions</label>
                    <div class="action-buttons">
                        <button class="btn btn-gradient" id="addTaskBtn">➕ Nouvelle Tâche</button>
                        <button class="btn btn-success" onclick="window.print()">🖨️ Imprimer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">⏱️</div>
                <div class="stat-title">Heures Passées</div>
                <div class="stat-value" id="heures-passees">0h</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">💰</div>
                <div class="stat-title">Budget Heures</div>
                <div class="stat-value" id="budget-heures">278h</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📋</div>
                <div class="stat-title">Tâches Terminées</div>
                <div class="stat-value" id="taches-terminees">0/0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📈</div>
                <div class="stat-title">Progression</div>
                <div class="stat-value" id="progression-globale">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⚡</div>
                <div class="stat-title">Productivité</div>
                <div class="stat-value" id="productivite">7.2 h/j</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🎯</div>
                <div class="stat-title">Statut</div>
                <div class="stat-value" id="statut-projet">En cours</div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">📊</span>
                        Progression Globale
                    </h3>
                    <span class="metric-value" id="progress-percentage">0%</span>
                </div>
                <div style="text-align: center;">
                    <svg class="progress-ring" viewBox="0 0 120 120">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#dc2626"/>
                                <stop offset="100%" style="stop-color:#ea580c"/>
                            </linearGradient>
                        </defs>
                        <circle class="progress-ring-circle progress-ring-bg" cx="60" cy="60" r="50"/>
                        <circle class="progress-ring-circle progress-ring-fill" cx="60" cy="60" r="50" id="progress-circle"/>
                    </svg>
                </div>
                <div class="metric-label" style="text-align: center;">
                    Avancement du projet
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">⏰</span>
                        Budget Temps
                    </h3>
                </div>
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span class="metric-label">Heures passées</span>
                        <span class="metric-value" style="font-size: 1.2rem;" id="heures-detail">0h / 278h</span>
                    </div>
                    <div style="background: var(--gray-200); height: 8px; border-radius: 4px; overflow: hidden;">
                        <div id="budget-progress-bar" style="height: 100%; background: linear-gradient(90deg, var(--primary-red), var(--primary-orange)); width: 0%; transition: width 1s ease;"></div>
                    </div>
                </div>
                <div id="budget-status" class="metric-label" style="text-align: center; font-weight: 600;">
                    Dans les temps
                </div>
            </div>
        </div>

        <!-- Gantt Chart -->
        <div class="gantt-container">
            <div id="gantt-chart">
                <div style="text-align: center; padding: 3rem; color: var(--gray-600);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                    <h3>Chargement du planning...</h3>
                    <p>Sélectionnez un chantier pour afficher les tâches</p>
                </div>
            </div>
        </div>

        <!-- Timeline -->
        <div class="timeline-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">📅</span>
                    Prochaines Étapes
                </h3>
            </div>
            <div class="timeline" id="timeline">
                <!-- Timeline items will be generated here -->
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">➕ Nouvelle Tâche</h3>
                <button class="modal-close" onclick="closeTaskModal()">✕</button>
            </div>
            
            <form id="taskForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nom de la tâche *</label>
                        <input type="text" class="form-input" id="task-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Responsable *</label>
                        <select class="form-select" id="task-responsable" required>
                            <option value="">Sélectionner un responsable</option>
                            <option value="FARID MESSAL (Chef de chantier)">FARID MESSAL (Chef de chantier)</option>
                            <option value="A MOHAMED (Chef d'équipe)">A MOHAMED (Chef d'équipe)</option>
                            <option value="ANTUNEZ LOIC (Chef d'équipe)">ANTUNEZ LOIC (Chef d'équipe)</option>
                            <option value="CLEMENTE MICKAEL (Chef d'équipe)">CLEMENTE MICKAEL (Chef d'équipe)</option>
                            <option value="CUKUR MUSTAFA (Chef d'équipe)">CUKUR MUSTAFA (Chef d'équipe)</option>
                            <option value="GRANDADAM G (Chef d'équipe)">GRANDADAM G (Chef d'équipe)</option>
                            <option value="RIBEIRO-CASAL A (Chef d'équipe)">RIBEIRO-CASAL A (Chef d'équipe)</option>
                            <option value="MOREAU JC (Chef d'équipe)">MOREAU JC (Chef d'équipe)</option>
                            <option value="YASAR ERTUGRUL (Conducteur de travaux)">YASAR ERTUGRUL (Conducteur de travaux)</option>
                            <option value="SYLVAIN GARREAU (Chargé d'affaires)">SYLVAIN GARREAU (Chargé d'affaires)</option>
                            <option value="LOU PIEDIGROSSI (HSE)">LOU PIEDIGROSSI (HSE)</option>
                            <option value="MARTIN HANGARD (Responsable d'agence)">MARTIN HANGARD (Responsable d'agence)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date de début *</label>
                        <input type="date" class="form-input" id="task-start-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Heures-Homme *</label>
                        <input type="number" class="form-input" id="task-hours" min="1" value="8" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Opérateurs *</label>
                        <input type="number" class="form-input" id="task-operators" min="1" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Statut</label>
                        <select class="form-select" id="task-status">
                            <option value="planifie">Planifié</option>
                            <option value="en-cours">En cours</option>
                            <option value="en-retard">En retard</option>
                            <option value="termine">Terminé</option>
                            <option value="travaux-sup">Travaux sup</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Progression</label>
                    <div class="range-group">
                        <input type="range" class="range-input" id="task-progress" min="0" max="100" value="0" oninput="updateProgressValue(this.value)">
                        <span class="range-value" id="progress-value">0%</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" id="delete-task-btn" onclick="deleteCurrentTask()" style="display: none;">🗑️ Supprimer</button>
                    <button type="button" class="btn" onclick="closeTaskModal()" style="background: var(--gray-300); color: var(--gray-700);">Annuler</button>
                    <button type="submit" class="btn btn-success">💾 Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class PlanningBooster {
            constructor() {
                this.tasks = [];
                this.currentChantier = 'Grand Lyon – Pont de Chasse';
                this.viewMode = 'week';
                this.currentEditingTask = null;
                this.hoursPerDay = 8.5;
                
                this.initData();
                this.initEventListeners();
                this.loadChantier(this.currentChantier);
            }

            initData() {
                this.chantiersData = {
                    'Grand Lyon – Pont de Chasse': {
                        tasks: [
                            { id: 1, nom: 'Préparation & Installation chantier', responsable: 'FARID MESSAL (Chef de chantier)', dateDebut: '2025-08-21', heuresHomme: 24, operateurs: 2, duree: 2, progression: 100, statut: 'termine' },
                            { id: 2, nom: 'Sablage surfaces métalliques', responsable: 'A MOHAMED (Chef d\'équipe)', dateDebut: '2025-08-23', heuresHomme: 68, operateurs: 3, duree: 3, progression: 85, statut: 'en-cours' },
                            { id: 3, nom: 'Application primaire anticorrosion', responsable: 'CLEMENTE MICKAEL (Chef d\'équipe)', dateDebut: '2025-08-26', heuresHomme: 51, operateurs: 2, duree: 3, progression: 60, statut: 'en-cours' },
                            { id: 4, nom: 'Application peinture intermédiaire', responsable: 'ANTUNEZ LOIC (Chef d\'équipe)', dateDebut: '2025-08-29', heuresHomme: 45, operateurs: 2, duree: 3, progression: 25, statut: 'en-cours' },
                            { id: 5, nom: 'Application finition', responsable: 'CUKUR MUSTAFA (Chef d\'équipe)', dateDebut: '2025-09-02', heuresHomme: 38, operateurs: 2, duree: 2, progression: 0, statut: 'planifie' },
                            { id: 6, nom: 'Contrôles qualité & mesures DFT', responsable: 'LOU PIEDIGROSSI (HSE)', dateDebut: '2025-09-04', heuresHomme: 16, operateurs: 1, duree: 2, progression: 0, statut: 'planifie' },
                            { id: 7, nom: 'Retouches & finitions', responsable: 'GRANDADAM G (Chef d\'équipe)', dateDebut: '2025-09-06', heuresHomme: 22, operateurs: 2, duree: 2, progression: 0, statut: 'planifie' },
                            { id: 8, nom: 'Nettoyage & repli chantier', responsable: 'FARID MESSAL (Chef de chantier)', dateDebut: '2025-09-09', heuresHomme: 14, operateurs: 2, duree: 1, progression: 0, statut: 'planifie' }
                        ],
                        budget: 278
                    },
                    'VICHY': {
                        tasks: [
                            { id: 1, nom: 'Installation du site', responsable: 'A MOHAMED (Chef d\'équipe)', dateDebut: '2025-08-22', heuresHomme: 20, operateurs: 2, duree: 2, progression: 80, statut: 'en-cours' },
                            { id: 2, nom: 'Préparation des structures', responsable: 'CLEMENTE MICKAEL (Chef d\'équipe)', dateDebut: '2025-08-24', heuresHomme: 50, operateurs: 3, duree: 3, progression: 60, statut: 'en-cours' },
                            { id: 3, nom: 'Sablage et nettoyage', responsable: 'ANTUNEZ LOIC (Chef d\'équipe)', dateDebut: '2025-08-28', heuresHomme: 40, operateurs: 2, duree: 3, progression: 40, statut: 'en-cours' },
                            { id: 4, nom: 'Peinture finition', responsable: 'CUKUR MUSTAFA (Chef d\'équipe)', dateDebut: '2025-09-01', heuresHomme: 30, operateurs: 2, duree: 2, progression: 10, statut: 'planifie' },
                            { id: 5, nom: 'Contrôle qualité final', responsable: 'LOU PIEDIGROSSI (HSE)', dateDebut: '2025-09-04', heuresHomme: 20, operateurs: 1, duree: 2, progression: 0, statut: 'planifie' }
                        ],
                        budget: 160
                    },
                    'CAMPENON BERNARD': {
                        tasks: [
                            { id: 1, nom: 'Échafaudage et sécurisation', responsable: 'FARID MESSAL (Chef de chantier)', dateDebut: '2025-08-23', heuresHomme: 60, operateurs: 3, duree: 3, progression: 90, statut: 'en-cours' },
                            { id: 2, nom: 'Nettoyage des surfaces', responsable: 'A MOHAMED (Chef d\'équipe)', dateDebut: '2025-08-27', heuresHomme: 50, operateurs: 2, duree: 3, progression: 60, statut: 'en-cours' },
                            { id: 3, nom: 'Application primaire', responsable: 'CLEMENTE MICKAEL (Chef d\'équipe)', dateDebut: '2025-08-31', heuresHomme: 40, operateurs: 2, duree: 3, progression: 35, statut: 'en-cours' },
                            { id: 4, nom: 'Application finition', responsable: 'ANTUNEZ LOIC (Chef d\'équipe)', dateDebut: '2025-09-04', heuresHomme: 30, operateurs: 2, duree: 2, progression: 0, statut: 'planifie' },
                            { id: 5, nom: 'Inspection finale', responsable: 'LOU PIEDIGROSSI (HSE)', dateDebut: '2025-09-07', heuresHomme: 20, operateurs: 1, duree: 2, progression: 0, statut: 'planifie' }
                        ],
                        budget: 200
                    },
                    'EFFIA PARKING BARET': {
                        tasks: [
                            { id: 1, nom: 'Nettoyage parking', responsable: 'A MOHAMED (Chef d\'équipe)', dateDebut: '2025-08-25', heuresHomme: 10, operateurs: 1, duree: 2, progression: 60, statut: 'en-cours' },
                            { id: 2, nom: 'Pose signalétique', responsable: 'ANTUNEZ LOIC (Chef d\'équipe)', dateDebut: '2025-08-27', heuresHomme: 20, operateurs: 1, duree: 3, progression: 40, statut: 'en-cours' },
                            { id: 3, nom: 'Peinture marquage', responsable: 'CLEMENTE MICKAEL (Chef d\'équipe)', dateDebut: '2025-08-30', heuresHomme: 25, operateurs: 2, duree: 3, progression: 20, statut: 'en-cours' },
                            { id: 4, nom: 'Installation automatisme', responsable: 'GRANDADAM G (Chef d\'équipe)', dateDebut: '2025-09-03', heuresHomme: 15, operateurs: 2, duree: 2, progression: 0, statut: 'planifie' },
                            { id: 5, nom: 'Contrôle & réception', responsable: 'LOU PIEDIGROSSI (HSE)', dateDebut: '2025-09-05', heuresHomme: 10, operateurs: 1, duree: 2, progression: 0, statut: 'planifie' }
                        ],
                        budget: 80
                    }
                };
            }

            initEventListeners() {
                document.getElementById('chantierSelect').addEventListener('change', (e) => {
                    this.loadChantier(e.target.value);
                });

                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelector('.view-btn.active').classList.remove('active');
                        e.target.classList.add('active');
                        this.viewMode = e.target.id.replace('view', '').toLowerCase();
                        this.renderGantt();
                    });
                });

                document.getElementById('addTaskBtn').addEventListener('click', () => {
                    this.openTaskModal();
                });

                document.getElementById('taskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveTask();
                });
            }

            loadChantier(chantierName) {
                this.currentChantier = chantierName;
                const data = this.chantiersData[chantierName];
                
                if (!data) return;

                this.tasks = data.tasks.map(task => ({
                    ...task,
                    dateDebut: new Date(task.dateDebut)
                }));
                
                this.budget = data.budget;
                
                document.getElementById('chantier-name').textContent = chantierName;
                document.getElementById('budget-heures').textContent = `${data.budget}h`;
                
                this.renderGantt();
                this.updateDashboard();
                this.updateTimeline();
            }

            renderGantt() {
                const container = document.getElementById('gantt-chart');
                
                if (this.tasks.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--gray-600);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📋</div>
                            <h3>Aucune tâche</h3>
                            <p>Cliquez sur "Nouvelle Tâche" pour commencer</p>
                        </div>
                    `;
                    return;
                }

                // Sort tasks by date
                this.tasks.sort((a, b) => a.dateDebut - b.dateDebut);

                // Calculate date range
                const minDate = new Date(this.tasks[0].dateDebut);
                minDate.setDate(minDate.getDate() - 3);
                
                let maxDate = new Date(minDate);
                this.tasks.forEach(task => {
                    const endDate = this.calculateEndDate(task.dateDebut, task.duree);
                    if (endDate > maxDate) maxDate = endDate;
                });
                maxDate.setDate(maxDate.getDate() + 7);

                // Generate header
                const headerHtml = this.generateDateHeader(minDate, maxDate);
                
                // Generate rows
                const rowsHtml = this.tasks.map(task => this.generateTaskRow(task, minDate, headerHtml.colWidth)).join('');

                container.innerHTML = `
                    <div class="gantt-header">
                        <div class="gantt-task-header">Tâches & Responsables</div>
                        <div class="gantt-dates-header">${headerHtml.html}</div>
                    </div>
                    <div class="gantt-body">
                        ${rowsHtml}
                    </div>
                `;

                // Add event listeners
                this.addGanttEventListeners();
            }

            generateDateHeader(minDate, maxDate) {
                let html = '';
                let colWidth = 60;
                let currentDate = new Date(minDate);

                if (this.viewMode === 'day') {
                    colWidth = 60;
                    while (currentDate <= maxDate) {
                        const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                        html += `<div class="gantt-date-cell ${isWeekend ? 'weekend' : ''}" style="min-width: ${colWidth}px;">
                            ${currentDate.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' })}
                        </div>`;
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                } else if (this.viewMode === 'week') {
                    colWidth = 80;
                    while (currentDate <= maxDate) {
                        html += `<div class="gantt-date-cell" style="min-width: ${colWidth}px;">
                            Sem. ${this.getWeekNumber(currentDate)}
                        </div>`;
                        currentDate.setDate(currentDate.getDate() + 7);
                    }
                } else {
                    colWidth = 120;
                    currentDate.setDate(1);
                    while (currentDate <= maxDate) {
                        html += `<div class="gantt-date-cell" style="min-width: ${colWidth}px;">
                            ${currentDate.toLocaleDateString('fr-FR', { month: 'long', year: '2-digit' })}
                        </div>`;
                        currentDate.setMonth(currentDate.getMonth() + 1);
                    }
                }

                return { html, colWidth };
            }

            generateTaskRow(task, minDate, colWidth) {
                const endDate = this.calculateEndDate(task.dateDebut, task.duree);
                const calendarDuration = (endDate - task.dateDebut) / (1000 * 60 * 60 * 24);
                let daysFromStart = (task.dateDebut - minDate) / (1000 * 60 * 60 * 24);
                
                let barLeft, barWidth;
                if (this.viewMode === 'day') {
                    barLeft = daysFromStart * colWidth;
                    barWidth = Math.max(calendarDuration * colWidth, 60);
                } else if (this.viewMode === 'week') {
                    barLeft = (daysFromStart / 7) * colWidth;
                    barWidth = Math.max((calendarDuration / 7) * colWidth, 60);
                } else {
                    barLeft = (daysFromStart / 30.4) * colWidth;
                    barWidth = Math.max((calendarDuration / 30.4) * colWidth, 60);
                }

                const statusLabels = {
                    'planifie': 'Planifié',
                    'en-cours': 'En cours',
                    'en-retard': 'En retard',
                    'termine': 'Terminé',
                    'travaux-sup': 'Travaux sup'
                };

                return `
                    <div class="gantt-row" data-task-id="${task.id}">
                        <div class="gantt-task-cell" onclick="planningBooster.openTaskModal(${task.id})">
                            <div class="gantt-task-name">${task.nom}</div>
                            <div class="gantt-task-responsable">${task.responsable}</div>
                            <div class="gantt-task-meta">
                                <span>${task.heuresHomme}h</span>
                                <span>${task.operateurs} op.</span>
                                <span>${statusLabels[task.statut]}</span>
                            </div>
                        </div>
                        <div class="gantt-chart-cell">
                            <div class="gantt-bar gantt-bar-${task.statut}" 
                                 style="left: ${barLeft}px; width: ${barWidth}px;"
                                 onclick="planningBooster.quickEditProgress(${task.id})">
                                ${task.progression}%
                                <div class="gantt-progress" style="width: ${task.progression}%;"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            addGanttEventListeners() {
                // Event listeners are added via onclick in the HTML for simplicity
            }

            calculateEndDate(startDate, workingDays) {
                let date = new Date(startDate);
                let addedDays = 0;
                
                while (addedDays < workingDays) {
                    date.setDate(date.getDate() + 1);
                    // Skip weekends
                    if (date.getDay() !== 0 && date.getDay() !== 6) {
                        addedDays++;
                    }
                }
                
                return date;
            }

            getWeekNumber(date) {
                const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
                const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
                return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            }

            updateDashboard() {
                const totalHeures = this.tasks.reduce((sum, task) => sum + task.heuresHomme, 0);
                const heuresPassees = this.tasks.reduce((sum, task) => sum + (task.heuresHomme * (task.progression / 100)), 0);
                const tachesTerminees = this.tasks.filter(t => t.progression === 100).length;
                const tachesTotales = this.tasks.length;
                
                const progressionGlobale = totalHeures > 0 ? (heuresPassees / totalHeures) * 100 : 0;
                const budgetProgress = this.budget > 0 ? (heuresPassees / this.budget) * 100 : 0;

                // Update statistics
                document.getElementById('heures-passees').textContent = `${Math.round(heuresPassees)}h`;
                document.getElementById('taches-terminees').textContent = `${tachesTerminees}/${tachesTotales}`;
                document.getElementById('progression-globale').textContent = `${Math.round(progressionGlobale)}%`;
                
                // Update budget status
                const budgetStatusEl = document.getElementById('budget-status');
                if (heuresPassees > this.budget * 1.1) {
                    budgetStatusEl.textContent = 'Budget dépassé';
                    budgetStatusEl.style.color = 'var(--danger)';
                } else if (heuresPassees > this.budget * 0.9) {
                    budgetStatusEl.textContent = 'Attention budget';
                    budgetStatusEl.style.color = 'var(--warning)';
                } else {
                    budgetStatusEl.textContent = 'Dans les temps';
                    budgetStatusEl.style.color = 'var(--success)';
                }

                // Update circular progress
                const progressPercentage = Math.round(progressionGlobale);
                document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
                
                const circle = document.getElementById('progress-circle');
                const circumference = 2 * Math.PI * 50;
                const strokeDashoffset = circumference - (progressPercentage / 100) * circumference;
                circle.style.strokeDashoffset = strokeDashoffset;

                // Update budget progress bar
                const budgetBar = document.getElementById('budget-progress-bar');
                budgetBar.style.width = `${Math.min(budgetProgress, 100)}%`;
                
                document.getElementById('heures-detail').textContent = `${Math.round(heuresPassees)}h / ${this.budget}h`;

                // Update productivity
                const joursEcoules = Math.max(1, Math.ceil((new Date() - new Date('2025-08-21')) / (1000 * 60 * 60 * 24)));
                const productivite = (heuresPassees / joursEcoules).toFixed(1);
                document.getElementById('productivite').textContent = `${productivite} h/j`;

                // Update project status
                let statut = 'Planifié';
                if (progressionGlobale >= 100) statut = 'Terminé';
                else if (progressionGlobale >= 75) statut = 'Avancé';
                else if (progressionGlobale >= 25) statut = 'En cours';
                else if (progressionGlobale > 0) statut = 'Commencé';
                
                document.getElementById('statut-projet').textContent = statut;
            }

            updateTimeline() {
                const timeline = document.getElementById('timeline');
                const prochainesToches = this.tasks
                    .filter(t => t.progression < 100)
                    .sort((a, b) => a.dateDebut - b.dateDebut)
                    .slice(0, 5);

                if (prochainesToches.length === 0) {
                    timeline.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--gray-600);">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">🎉</div>
                            <h4>Toutes les tâches sont terminées !</h4>
                        </div>
                    `;
                    return;
                }

                timeline.innerHTML = prochainesToches.map(task => {
                    const dateStr = task.dateDebut.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'short'
                    });

                    const statusLabels = {
                        'planifie': 'À faire',
                        'en-cours': 'En cours',
                        'en-retard': 'En retard'
                    };

                    return `
                        <div class="timeline-item">
                            <div class="timeline-date">${dateStr}</div>
                            <div class="timeline-title">${task.nom}</div>
                            <div class="timeline-desc">
                                ${task.responsable} • ${task.heuresHomme}h • ${statusLabels[task.statut] || 'Planifié'}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            openTaskModal(taskId = null) {
                this.currentEditingTask = taskId;
                const modal = document.getElementById('taskModal');
                const isEditing = taskId !== null;
                
                document.getElementById('modal-title').textContent = isEditing ? '✏️ Modifier la Tâche' : '➕ Nouvelle Tâche';
                document.getElementById('delete-task-btn').style.display = isEditing ? 'inline-flex' : 'none';

                if (isEditing) {
                    const task = this.tasks.find(t => t.id === taskId);
                    if (task) {
                        document.getElementById('task-name').value = task.nom;
                        document.getElementById('task-responsable').value = task.responsable;
                        document.getElementById('task-start-date').value = task.dateDebut.toISOString().split('T')[0];
                        document.getElementById('task-hours').value = task.heuresHomme;
                        document.getElementById('task-operators').value = task.operateurs;
                        document.getElementById('task-status').value = task.statut;
                        document.getElementById('task-progress').value = task.progression;
                        document.getElementById('progress-value').textContent = `${task.progression}%`;
                    }
                } else {
                    document.getElementById('taskForm').reset();
                    document.getElementById('task-start-date').value = new Date().toISOString().split('T')[0];
                    document.getElementById('progress-value').textContent = '0%';
                }

                modal.style.display = 'flex';
            }

            saveTask() {
                const taskData = {
                    id: this.currentEditingTask || Date.now(),
                    nom: document.getElementById('task-name').value,
                    responsable: document.getElementById('task-responsable').value,
                    dateDebut: new Date(document.getElementById('task-start-date').value),
                    heuresHomme: parseInt(document.getElementById('task-hours').value),
                    operateurs: parseInt(document.getElementById('task-operators').value),
                    progression: parseInt(document.getElementById('task-progress').value),
                    statut: document.getElementById('task-status').value
                };

                taskData.duree = Math.ceil(taskData.heuresHomme / (taskData.operateurs * this.hoursPerDay));

                if (this.currentEditingTask) {
                    const index = this.tasks.findIndex(t => t.id === this.currentEditingTask);
                    this.tasks[index] = taskData;
                } else {
                    this.tasks.push(taskData);
                }

                this.renderGantt();
                this.updateDashboard();
                this.updateTimeline();
                this.closeTaskModal();
            }

            deleteCurrentTask() {
                if (this.currentEditingTask && confirm('Supprimer cette tâche ?')) {
                    this.tasks = this.tasks.filter(t => t.id !== this.currentEditingTask);
                    this.renderGantt();
                    this.updateDashboard();
                    this.updateTimeline();
                    this.closeTaskModal();
                }
            }

            quickEditProgress(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task) return;

                const newProgress = prompt(`Progression actuelle: ${task.progression}%\n\nNouvelle progression (0-100):`, task.progression);
                
                if (newProgress !== null && !isNaN(newProgress)) {
                    const progress = Math.max(0, Math.min(100, parseInt(newProgress)));
                    task.progression = progress;
                    
                    // Auto-update status based on progress
                    if (progress === 100) {
                        task.statut = 'termine';
                    } else if (progress > 0) {
                        task.statut = 'en-cours';
                    }
                    
                    this.renderGantt();
                    this.updateDashboard();
                    this.updateTimeline();
                }
            }

            closeTaskModal() {
                document.getElementById('taskModal').style.display = 'none';
                this.currentEditingTask = null;
            }
        }

        // Global functions
        function closeTaskModal() {
            planningBooster.closeTaskModal();
        }

        function deleteCurrentTask() {
            planningBooster.deleteCurrentTask();
        }

        function updateProgressValue(value) {
            document.getElementById('progress-value').textContent = `${value}%`;
        }

        // Initialize when DOM is ready
        let planningBooster;
        document.addEventListener('DOMContentLoaded', () => {
            planningBooster = new PlanningBooster();
        });

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeTaskModal();
            }
        });
    </script>
</body>
</html>