<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Param√®tres - Tugrul V0.8.1</title>
    

  <link rel="stylesheet" href="../assets/css/shared.css">
  <link rel="stylesheet" href="../assets/css/print.css" media="print">

</head>
<body>
  <div id="helpMount"></div>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Param√®tres & Base de Donn√©es</h1>
            <p class="page-subtitle">Gestion des chantiers, personnel et configurations</p>
        </div>

        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-button active" data-tab="personnel">üë• Personnel</button>
                <button class="tab-button" data-tab="chantiers">üèóÔ∏è Chantiers</button>
                <button class="tab-button" data-tab="configuration">‚öôÔ∏è Configuration</button>
            </div>

            <!-- Onglet Personnel -->
            <div id="tab-personnel" class="tab-content active">
                <h2 class="section-title">Base de Donn√©es Personnel</h2>
                
                <div class="search-bar">
                    <input type="text" class="search-input" id="search-personnel" placeholder="üîç Rechercher une personne...">
                </div>

                <table class="data-table" id="personnel-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>R√¥le</th>
                            <th>Statut</th>
                            <th>Disponibilit√©</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="personnel-tbody">
                        <!-- Les donn√©es seront charg√©es via JavaScript -->
                    </tbody>
                </table>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="import-personnel">üì• Importer</button>
                    <button class="btn btn-success" id="export-personnel">üì§ Exporter</button>
                    <button class="btn btn-primary" id="add-personnel">‚ûï Ajouter Personne</button>
                </div>
            </div>

            <!-- Onglet Chantiers -->
            <div id="tab-chantiers" class="tab-content">
                <h2 class="section-title">Base de Donn√©es Chantiers</h2>
                
                <div class="search-bar">
                    <input type="text" class="search-input" id="search-chantiers" placeholder="üîç Rechercher un chantier...">
                </div>

                <h3 style="margin-bottom: 1rem; color: var(--primary-red);">Chantiers en Cours</h3>
                <table class="data-table" id="chantiers-cours-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Num√©ro</th>
                            <th>Chef de Chantier</th>
                            <th>Progression</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="chantiers-cours-tbody">
                        <!-- Les donn√©es seront charg√©es via JavaScript -->
                    </tbody>
                </table>

                <h3 style="margin: 2rem 0 1rem; color: var(--info);">Chantiers √† Venir</h3>
                <table class="data-table" id="chantiers-venir-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Num√©ro</th>
                            <th>Chef Pr√©vu</th>
                            <th>OTP SAP</th>
                            <th>OTP SharePoint</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="chantiers-venir-tbody">
                        <!-- Les donn√©es seront charg√©es via JavaScript -->
                    </tbody>
                </table>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="import-chantiers">üì• Importer</button>
                    <button class="btn btn-success" id="export-chantiers">üì§ Exporter</button>
                    <button class="btn btn-primary" id="add-chantier">‚ûï Ajouter Chantier</button>
                </div>
            </div>

            <!-- Onglet Configuration -->
            <div id="tab-configuration" class="tab-content">
                <h2 class="section-title">Configuration G√©n√©rale</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nom de l'√©quipe</label>
                        <input type="text" class="form-input" value="√âquipe 41 Chasse sur Rh√¥ne">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Responsable d'agence</label>
                        <select class="form-select">
                            <option value="martin-hangard">MARTIN HANGARD</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Conducteur de travaux</label>
                        <select class="form-select">
                            <option value="yasar-ertugrul">YASAR ERTUGRUL</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Charg√© d'affaires</label>
                        <select class="form-select">
                            <option value="sylvain-garreau">SYLVAIN GARREAU</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact HSE</label>
                        <select class="form-select">
                            <option value="lou-piedigrossi">LOU PIEDIGROSSI</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Format d'export par d√©faut</label>
                        <select class="form-select">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="word">Word</option>
                        </select>
                    </div>
                </div>

                <h3 style="margin: 2rem 0 1rem; color: var(--text-primary);">Types de Travaux</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Types disponibles</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <span class="badge badge-chef">Sablage</span>
                            <span class="badge badge-operateur">Peinture industrielle</span>
                            <span class="badge badge-sous-traitant">Nettoyage</span>
                            <span class="badge badge-interimaire">Grenaillage</span>
                            <span class="badge badge-altrad">Traitement anticorrosion</span>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary">üîÑ R√©initialiser</button>
                    <button class="btn btn-primary">üíæ Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ajouter/Modifier Personnel -->
    <div class="modal-overlay" id="modal-personnel">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-personnel-title">Ajouter Personne</h2>
                <button class="modal-close" id="close-modal-personnel">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-personnel">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nom complet</label>
                            <input type="text" class="form-input" id="personnel-nom" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">R√¥le</label>
                            <select class="form-select" id="personnel-role" required>
                                <option value="chef-equipe">Chef d'√©quipe</option>
                                <option value="operateur">Op√©rateur</option>
                                <option value="chef-chantier">Chef de chantier</option>
                                <option value="conducteur-travaux">Conducteur de travaux</option>
                                <option value="charge-affaires">Charg√© d'affaires</option>
                                <option value="hse">HSE</option>
                                <option value="responsable-agence">Responsable d'agence</option>
                                <option value="sous-traitant">Sous-traitant</option>
                                <option value="interimaire">Int√©rimaire</option>
                                <option value="altrad-autre">Altrad autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-input" id="personnel-tel">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="personnel-email">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-personnel">Annuler</button>
                <button class="btn btn-primary" id="save-personnel">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Modal Ajouter/Modifier Chantier -->
    <div class="modal-overlay" id="modal-chantier">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-chantier-title">Ajouter Chantier</h2>
                <button class="modal-close" id="close-modal-chantier">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-chantier">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nom du chantier</label>
                            <input type="text" class="form-input" id="chantier-nom" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Num√©ro</label>
                            <input type="text" class="form-input" id="chantier-numero">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select class="form-select" id="chantier-type" required>
                                <option value="en-cours">En cours</option>
                                <option value="a-venir">√Ä venir</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chef de chantier</label>
                            <select class="form-select" id="chantier-chef">
                                <option value="">√Ä d√©finir</option>
                                <option value="farid-messal">FARID MESSAL</option>
                                <option value="a-mohamed">A MOHAMED</option>
                                <option value="antunez-loic">ANTUNEZ LOIC</option>
                                <option value="clemente-mickael">CLEMENTE MICKAEL</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-chantier">Annuler</button>
                <button class="btn btn-primary" id="save-chantier">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es initiale du personnel
        const personnelData = [
            // Chefs d'√©quipe
            { id: 1, nom: "A MOHAMED", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            { id: 2, nom: "ANTUNEZ LOIC", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            { id: 3, nom: "CLEMENTE MICKAEL", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            { id: 4, nom: "CUKUR MUSTAFA", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            { id: 5, nom: "GRANDADAM G", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            { id: 6, nom: "RIBEIRO-CASAL A", role: "chef-equipe", statut: "actif", disponibilite: "En cong√©" },
            { id: 7, nom: "MOREAU JC", role: "chef-equipe", statut: "actif", disponibilite: "Disponible" },
            
            // Op√©rateurs
            { id: 8, nom: "BLANC MARQUIS D", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            { id: 9, nom: "CUKUR AYHAN", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            { id: 10, nom: "MORGADO ALEX", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            { id: 11, nom: "ROCHDI YOUSSEF", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            { id: 12, nom: "HADIDI A", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            { id: 13, nom: "ROBIC NICOLAS", role: "operateur", statut: "actif", disponibilite: "Disponible" },
            
            // Chef de chantier
            { id: 14, nom: "FARID MESSAL", role: "chef-chantier", statut: "actif", disponibilite: "Disponible" },
            
            // Management
            { id: 15, nom: "YASAR ERTUGRUL", role: "conducteur-travaux", statut: "actif", disponibilite: "Disponible" },
            { id: 16, nom: "SYLVAIN GARREAU", role: "charge-affaires", statut: "actif", disponibilite: "Disponible" },
            { id: 17, nom: "LOU PIEDIGROSSI", role: "hse", statut: "actif", disponibilite: "Disponible" },
            { id: 18, nom: "MARTIN HANGARD", role: "responsable-agence", statut: "actif", disponibilite: "Disponible" },
            
            // Altrad autre
            { id: 19, nom: "DJEBBAR Khalil", role: "altrad-autre", statut: "actif", disponibilite: "Disponible" },
            
            // Sous-traitants
            { id: 20, nom: "EURO PEINTURE 1", role: "sous-traitant", statut: "actif", disponibilite: "Disponible" },
            { id: 21, nom: "EURO PEINTURE 2", role: "sous-traitant", statut: "actif", disponibilite: "Disponible" },
            { id: 22, nom: "SAINT'ELEC 1", role: "sous-traitant", statut: "actif", disponibilite: "Disponible" },
            { id: 23, nom: "DALZEMIR 1", role: "sous-traitant", statut: "actif", disponibilite: "Disponible" },
            { id: 24, nom: "GUILLE Pascal", role: "sous-traitant", statut: "actif", disponibilite: "Disponible" },
            
            // Int√©rimaires
            { id: 25, nom: "NASSER MESSAL", role: "interimaire", statut: "actif", disponibilite: "Disponible" },
            { id: 26, nom: "LAARAJ", role: "interimaire", statut: "actif", disponibilite: "Disponible" }
        ];

        // Base de donn√©es des chantiers
        const chantiersData = {
            enCours: [
                { id: 1, nom: "Grand Lyon ‚Äì Pont de Chasse", numero: "22111 13275", chef: "FARID MESSAL", progression: 75 },
                { id: 2, nom: "VICHY", numero: "22341113974", chef: "CLEMENTE MICKAEL", progression: 45 },
                { id: 3, nom: "CAMPENON BERNARD", numero: "22441114303", chef: "ANTUNEZ LOIC", progression: 60 },
                { id: 4, nom: "EFFIA PARKING BARET", numero: "22541114454", chef: "A MOHAMED", progression: 25 },
                { id: 5, nom: "EFFIA PARKING CANNES", numero: "22541114465", chef: "CUKUR MUSTAFA", progression: 80 },
                { id: 6, nom: "Mirage 2000", numero: "22541100038", chef: "GRANDADAM G", progression: 40 },
                { id: 7, nom: "QPARK FAVENTINE BOUYGUE VELODROME", numero: "22541114488", chef: "MOREAU JC", progression: 65 },
                { id: 8, nom: "Atelier St Maurice", numero: "", chef: "FARID MESSAL", progression: 90 },
                { id: 9, nom: "SAINT GOBAIN - Atelier", numero: "22541100038", chef: "RIBEIRO-CASAL A", progression: 35 }
            ],
            aVenir: [
                { id: 10, nom: "EFFIA ‚Äì MONTPELLIER", numero: "22541100038", chef: "√Ä d√©finir", otpSap: "oui", otpSp: "en-cours" },
                { id: 11, nom: "QPARK HDV Marseille", numero: "", chef: "CUKUR MUSTAFA", otpSap: "non", otpSp: "non" },
                { id: 12, nom: "EFFIA ‚Äì Parking Cour JULIEN", numero: "225411 14490", chef: "√Ä d√©finir", otpSap: "en-cours", otpSp: "oui" },
                { id: 13, nom: "EFFIA BEZIERS", numero: "22541100038", chef: "ANTUNEZ LOIC", otpSap: "non", otpSp: "non" },
                { id: 14, nom: "ADISEO PONTICELLI", numero: "22541100038", chef: "√Ä d√©finir", otpSap: "oui", otpSp: "en-cours" },
                { id: 15, nom: "FRAMATOME", numero: "22141100002", chef: "GRANDADAM G", otpSap: "en-cours", otpSp: "oui" },
                { id: 16, nom: "EFFIA ‚Äì Parking Chateaucreux", numero: "223411 14193", chef: "√Ä d√©finir", otpSap: "non", otpSp: "en-cours" },
                { id: 17, nom: "CNR VAUGRIS", numero: "22541100038", chef: "MOREAU JC", otpSap: "oui", otpSp: "oui" }
            ]
        };

        // Fonctions utilitaires
        function getRoleBadge(role) {
            const roleNames = {
                'chef-equipe': 'Chef d\'√©quipe',
                'operateur': 'Op√©rateur',
                'chef-chantier': 'Chef de chantier',
                'conducteur-travaux': 'Conducteur de travaux',
                'charge-affaires': 'Charg√© d\'affaires',
                'hse': 'HSE',
                'responsable-agence': 'Responsable d\'agence',
                'sous-traitant': 'Sous-traitant',
                'interimaire': 'Int√©rimaire',
                'altrad-autre': 'Altrad autre'
            };
            
            const badgeClasses = {
                'chef-equipe': 'badge-chef',
                'chef-chantier': 'badge-chef',
                'conducteur-travaux': 'badge-chef',
                'charge-affaires': 'badge-chef',
                'responsable-agence': 'badge-chef',
                'operateur': 'badge-operateur',
                'hse': 'badge-operateur',
                'sous-traitant': 'badge-sous-traitant',
                'interimaire': 'badge-interimaire',
                'altrad-autre': 'badge-altrad'
            };
            
            return `<span class="badge ${badgeClasses[role]}">${roleNames[role] || role}</span>`;
        }

        // Fonctions de rendu des tableaux
        function renderPersonnelTable() {
            const tbody = document.getElementById('personnel-tbody');
            tbody.innerHTML = '';
            
            personnelData.forEach(person => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${person.nom}</td>
                    <td>${getRoleBadge(person.role)}</td>
                    <td><span class="badge ${person.statut === 'actif' ? 'badge-operateur' : 'badge-sous-traitant'}">${person.statut}</span></td>
                    <td>${person.disponibilite}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editPersonnel(${person.id})">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-sm" onclick="deletePersonnel(${person.id})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderChantiersTable() {
            // Chantiers en cours
            const tbodyEnCours = document.getElementById('chantiers-cours-tbody');
            tbodyEnCours.innerHTML = '';
            
            chantiersData.enCours.forEach(chantier => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${chantier.nom}</td>
                    <td>${chantier.numero || 'N/A'}</td>
                    <td>${chantier.chef}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 60px; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${chantier.progression}%; height: 100%; background: linear-gradient(90deg, var(--primary-red), var(--primary-orange));"></div>
                            </div>
                            <span style="font-size: 0.8rem;">${chantier.progression}%</span>
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editChantier(${chantier.id}, 'en-cours')">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteChantier(${chantier.id}, 'en-cours')">üóëÔ∏è</button>
                    </td>
                `;
                tbodyEnCours.appendChild(row);
            });
            
            // Chantiers √† venir
            const tbodyAVenir = document.getElementById('chantiers-venir-tbody');
            tbodyAVenir.innerHTML = '';
            
            chantiersData.aVenir.forEach(chantier => {
                const otpSapBadge = chantier.otpSap === 'oui' ? 'badge-operateur' : chantier.otpSap === 'en-cours' ? 'badge-sous-traitant' : 'badge-interimaire';
                const otpSpBadge = chantier.otpSp === 'oui' ? 'badge-operateur' : chantier.otpSp === 'en-cours' ? 'badge-sous-traitant' : 'badge-interimaire';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${chantier.nom}</td>
                    <td>${chantier.numero || 'N/A'}</td>
                    <td>${chantier.chef}</td>
                    <td><span class="badge ${otpSapBadge}">${chantier.otpSap}</span></td>
                    <td><span class="badge ${otpSpBadge}">${chantier.otpSp}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editChantier(${chantier.id}, 'a-venir')">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteChantier(${chantier.id}, 'a-venir')">üóëÔ∏è</button>
                    </td>
                `;
                tbodyAVenir.appendChild(row);
            });
        }

        // Fonctions d'√©dition et suppression
        function editPersonnel(id) {
            const person = personnelData.find(p => p.id === id);
            if (person) {
                document.getElementById('modal-personnel-title').textContent = 'Modifier Personne';
                document.getElementById('personnel-nom').value = person.nom;
                document.getElementById('personnel-role').value = person.role;
                document.getElementById('modal-personnel').style.display = 'flex';
            }
        }

        function deletePersonnel(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette personne ?')) {
                const index = personnelData.findIndex(p => p.id === id);
                if (index > -1) {
                    personnelData.splice(index, 1);
                    renderPersonnelTable();
                }
            }
        }

        function editChantier(id, type) {
            const chantiers = type === 'en-cours' ? chantiersData.enCours : chantiersData.aVenir;
            const chantier = chantiers.find(c => c.id === id);
            if (chantier) {
                document.getElementById('modal-chantier-title').textContent = 'Modifier Chantier';
                document.getElementById('chantier-nom').value = chantier.nom;
                document.getElementById('chantier-numero').value = chantier.numero || '';
                document.getElementById('chantier-type').value = type;
                document.getElementById('modal-chantier').style.display = 'flex';
            }
        }

        function deleteChantier(id, type) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce chantier ?')) {
                const chantiers = type === 'en-cours' ? chantiersData.enCours : chantiersData.aVenir;
                const index = chantiers.findIndex(c => c.id === id);
                if (index > -1) {
                    chantiers.splice(index, 1);
                    renderChantiersTable();
                }
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Rendu initial des tableaux
            renderPersonnelTable();
            renderChantiersTable();
            
            // Gestion des onglets
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // D√©sactiver tous les onglets
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Activer l'onglet s√©lectionn√©
                    this.classList.add('active');
                    document.getElementById(`tab-${tabId}`).classList.add('active');
                });
            });
            
            // Gestion des modales
            document.getElementById('add-personnel').addEventListener('click', () => {
                document.getElementById('modal-personnel-title').textContent = 'Ajouter Personne';
                document.getElementById('form-personnel').reset();
                document.getElementById('modal-personnel').style.display = 'flex';
            });
            
            document.getElementById('add-chantier').addEventListener('click', () => {
                document.getElementById('modal-chantier-title').textContent = 'Ajouter Chantier';
                document.getElementById('form-chantier').reset();
                document.getElementById('modal-chantier').style.display = 'flex';
            });
            
            // Fermeture des modales
            document.querySelectorAll('.modal-close, .btn-secondary').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.style.display = 'none';
                    });
                });
            });
            
            // Recherche
            document.getElementById('search-personnel').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#personnel-tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
            
            document.getElementById('search-chantiers').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#chantiers-cours-tbody tr, #chantiers-venir-tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        });
    </script>

  <script type="module">
    import { mountHelp } from '../assets/js/help.js';
    mountHelp(document.getElementById('helpMount') || document.body);
  </script>

</body>
</html>